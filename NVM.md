# NVMを使う

PIC18FのProgram Flash Memory をセクタ代わりに使う。

* ERASEが128byte単位。READ/WRITEは1バイト単位でもできる。
* ERASE単位に合わせて128byte sector R/Wをベースに考える。
* PIC18F47Q43はプログラムフラッシュメモリが128kBある。ファームプログラムとブートロード用68000プログラムで32kも使わないだろうから、64kB程度は仮想ディスクに割り当てできる。
* FORTHの慣習的に1ページは1024バイトなので。ページ番号を指定して読み書き。バックバッファ数は見えない。最低2ページと決まっているようだが。
* READSECTOR/WRITESECTOR/ERASEのコマンドが用意されており、ビットをポーリングして処理完了を知る。
* コマンド実行中はCPUはストールする。割り込みも禁止しておく。
* 3チップ構成の場合、PICから直接SRAMに読み書きできない。68008に対してセクタRead/Write APIをPIC側で提供し、それを呼び出すようにする。
